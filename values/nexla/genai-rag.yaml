---
## @section Global parameters
## Global parameters
## These variables are accessible to all dependency helm charts.
##

global:
  tags:
    billing-team: "connectors"
    billing-unit: "engineering"
    billing-cost-center: "testfm-usa"
    billing:project: "saas"
    billing:environment: "{{ .Values.global.environment }}"

  ## @param global.labels Define common labels for all IAC and app resources generated by this chart.
  ##
  labels:
    application-type: "genai-rag"
    application-class: "exclusive"
  ## @param global.annotations Define common annotations for all IAC and app resources generated by this chart.
  ##
  annotations: {}
  ## @param global.environment Application environment
  ##
  environment: 'dev'

## @section Charg configurations
##
common-res:
  ## @param common-res.enabled Toggle for enabling or disabling statefulset resources.
  ##
  enabled: true
  StatefulSet:
    items:
      _:
        ## @skip common-res.StatefulSet.items._.annotations
        ##
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/path: /metrics
          prometheus.io/port: "9000"
        # strategy:
          ## @param common-res.StatefulSet.items._.strategy.type Set the controller upgrade strategy
          ## For StatefulSets, valid values are Recreate (default) and RollingUpdate.
          ##
          # type: "RollingUpdate"
          ## RollingUpdate strategy configuration
          ##
          # rollingUpdate:
            ## @param common-res.StatefulSet.items._.strategy.rollingUpdate.maxUnavailable Set statefulset RollingUpdate max unavailable
            ##
            # maxUnavailable: "66%"
            ## @param common-res.StatefulSet.items._.strategy.rollingUpdate.maxSurge Set statefulset RollingUpdate max surge
            ##
            # maxSurge: "33%"

        ## @param common-res.StatefulSet.items._.selector Additional selectors for the statefulset
        ##
        selector: {}

        replicas: 1

        ## Pod spec template (to generate spec.template)
        ##
        podSpec:
          spec:
            ## @param common-res.StatefulSet.items._.podSpec.spec.automountServiceAccountToken Automount Service account token
            ##
            automountServiceAccountToken: true

            ## @param common-res.StatefulSet.items._.podSpec.spec.terminateGracePeriodSeconds Termination grace period in seconds
            ##
            # terminationGracePeriodSeconds: 172800

            ## @param common-res.StatefulSet.items._.podSpec.spec.imagePullSecrets Image pull secrets
            ##
            # imagePullSecrets: 

            ## @param common-res.StatefulSet.items._.podSpec.spec.serviceAccountName Service account name
            ##
            # serviceAccountName: '{{ include "common-gitops.names.release" . }}'
            ## TODO: Let each application have its own service account
            serviceAccountName: 'svc-testfm'

            ## @param common-res.StatefulSet.items._.podSpec.spec.restartPolicy Restart policy for the pod
            # restartPolicy: Always

            ## Configure the Security Context for the Pod
            securityContext:
              ## @param common-res.StatefulSet.items._.podSpec.spec.securityContext.fsGroup Specify the default fs group id
              ##
              fsGroup: 99
              ## @param common-res.StatefulSet.items._.podSpec.spec.securityContext.supplementalGroups Specify the additional groups
              ##
              supplementalGroups: []
              ## @param common-res.StatefulSet.items._.podSpec.spec.securityContext.fsGroupChangePolicy Specify the default gs group change policy
              ##
              fsGroupChangePolicy: OnRootMismatch

            ## @skip common-res.StatefulSet.items._.podSpec.spec.tolerations
            ##
            tolerations:
              - key: "core-testfm-apps"
                operator: "Equal"
                value: "true"
                effect: "NoSchedule"
              - key: "core-testfm-apps"
                operator: "Equal"
                value: "true"
                effect: "NoExecute"

            ## @skip common-res.StatefulSet.items._.podSpec.spec.affinity
            ##
            affinity:
              nodeAffinity:
                requiredDuringSchedulingIgnoredDuringExecution:
                  nodeSelectorTerms:
                  - matchExpressions:
                    - key: eks.amazonaws.com/nodegroup
                      operattor: In
                      values:
                      - Core-testfm-Apps

                  # - labelSelector:
                  #     matchExpressions:
                  #       - key: application-class
                  #         operator: In
                  #         values:
                  #           - "exclusive"
                  #   topologyKey: "kubernetes.io/hostname"

            ## @skip common-res.StatefulSet.items._.podSpec.spec.nodeSelector
            ##
            # nodeSelector:
            #   eks.amazonaws.com/nodegroup: Sinks-testfm-Apps

            ## Containers configuration
            containers:
              genai-rag:
                ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.image
                ##
                ## @section Default configurations
                image: "docker.io/testfm/genai-rag:main-194"

                ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.imagePullPolicy Container image pullPolicy. Allowed values: `IfNotPresent`, `Always`, `Never`
                ##
                imagePullPolicy: 'IfNotPresent'

                ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.lifecycle Container lifecycle hook
                ##
                # lifecycle:
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.lifecycle.preStop PreStop lifecycle hook
                  ## @skip common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.lifecycle.preStop.exec
                  # preStop:
                  #   exec:
                  #     command:
                  #       - "/bin/bash"
                  #       - "-c"
                  #       - "/scripts/lifecycle_hook.sh | tee -a /tmp/lifecycle_hook.log"
                command:
                  - "bash"
                  - "/genai-rag/entrypoint.sh"

                ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.tty Determines whether containers in a pod runs with TTY enabled.
                ##
                tty: false

                ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.stdin Determines whether containers in a pod runs with stdin enabled.
                ##
                stdin: false

                ## Container ports configuration
                ##
                ports:
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[0].name Name of the port
                  ##
                  - name: http
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[0].containerPort The port number
                    ##
                    containerPort: 8000

                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[0].protocol Port protocol. Allowed values: "SCTP", `TCP` and `UDP`.
                    ##
                    protocol: TCP

                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[1].name Name of the port
                  - name: metrics
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[1].containerPort The port number
                    ##
                    containerPort: 9000
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[1].protocol Port protocol
                    ##
                    protocol: TCP

                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[2].name Name of the port
                  - name: testfmmetrics
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[2].containerPort The port number
                    ##
                    containerPort: 9000
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.ports[2].protocol Port protocol
                    ##
                    protocol: TCP

                # ## Liveness probe configuration
                # ##
                livenessProbe:
                  httpGet:
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.httpGet.port Liveness probe port
                    ##
                    port: 8000
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.httpGet.scheme Liveness probe connection protocol
                    ##
                    scheme: HTTP
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.httpGet.path If a HTTP probe is used (default for HTTP/HTTPS services) this path is used
                    ##
                    path: "/health-ckeck/"
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.initialDelaySeconds Initial delay in seconds
                  ##
                  initialDelaySeconds: 110
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.periodSeconds period in seconds
                  ##
                  periodSeconds: 50
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.timeoutSeconds Timeout in seconds
                  ##
                  timeoutSeconds: 6
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.failureThreshold max number of failures in a row for flagging pod as unhealthy
                  ##
                  failureThreshold: 30
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.livenessProbe.successThreshold max number of successes in a row for flagging pod as healthy
                  ##
                  successThreshold: 1

                ## Readiness probe configuration
                ##
                readinessProbe:
                  httpGet:
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.httpGet.port readiness probe port
                    ##
                    port: 8000
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.httpGet.scheme readiness probe connection protocol
                    ##
                    scheme: HTTP
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.httpGet.path If a HTTP probe is used (default for HTTP/HTTPS services) this path is used
                    ##
                    path: "/health-check/"
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.initialDelaySeconds Initial delay in seconds
                  ##
                  initialDelaySeconds: 110
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.periodSeconds period in seconds
                  ##
                  periodSeconds: 50
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.timeoutSeconds Timeout in seconds
                  ##
                  timeoutSeconds: 6
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.failureThreshold max number of failures in a row for flagging pod as not ready
                  ##
                  failureThreshold: 30
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.readinessProbe.successThreshold max number of successes in a row for flagging pod as ready
                  ##
                  successThreshold: 1

                # ## Startup probe configuration
                # ##
                # startupProbe:
                #   tcpSocket:
                #     ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.startupProbe.tcpSocket.port startup probe port
                #     ##
                #     port: 3000
                #   ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.startupProbe.initialDelaySeconds Initial delay in seconds
                #   ##
                #   initialDelaySeconds: 10
                #   ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.startupProbe.periodSeconds period in seconds
                #   ##
                #   periodSeconds: 5
                #   ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.startupProbe.timeoutSeconds Timeout in seconds
                #   ##
                #   timeoutSeconds: 2
                #   ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.startupProbe.failureThreshold max number of failures in a row for flagging pod as not started
                #   ##
                #   failureThreshold: 60
                #   ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.startupProbe.successThreshold max number of successes in a row for flagging pod as started
                #   ##
                #   successThreshold: 1

                ## Set the resource requests / limits for the main container.
                ##
                resources:
                  ## Resource limits configuration
                  ##
                  limits:
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.resources.limits.cpu CPU limits
                    ##
                    cpu: '4000m'
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.resources.limits.memory Memory limits
                    ##
                    memory: '16Gi'

                  ## Resource Requests configurations
                  ##
                  requests:
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.resources.requests.cpu CPU requests
                    ##
                    cpu: '1000m'
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.resources.requests.memory Memory requests
                    ##
                    memory: '4Gi'

                ## Security context configuration
                ##
                securityContext:
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.runAsGroup Specify the default user group id
                  ##
                  runAsGroup: 99
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.runAsUser Specify the default user id
                  ##
                  runAsUser: 99
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.privileged Privileged mode true or false. Allowed values: `true` or `false`
                  ##
                  privileged: false
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.readOnlyRootFilesystem Access level for the file system.  Allowed values: `true` or `false`
                  ##
                  readOnlyRootFilesystem: false
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.allowPrivilegeEscalation Allow escalation of privileges true or false. Allowed values: `true` or `false`
                  ##
                  allowPrivilegeEscalation: false
                  ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.runAsNonRoot Run the process as root, true or false. Allowed values: `true` or `false`
                  ##
                  runAsNonRoot: true
                  seccompProfile:
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.seccompProfile.type Seccomp profile type
                    ##
                    type: RuntimeDefault
                  ## Linux pod capabilities configurations
                  ## https://man7.org/linux/man-pages/man7/capabilities.7.html
                  ##
                  capabilities:
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.capabilities.drop Capabilities to drop
                    ##
                    drop:
                      - ALL
                    ## @param common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.securityContext.capabilities.add Capabilities to add
                    ##
                    add: []

                ## Env configuration
                ## @skip common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.env
                ##
                env:
                  - name: APPLICATION_CREDS_PATH
                    value: "/data/application-creds/application-creds"

                ## @skip common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.envFrom
                ##
                envFrom:
                  - configMapRef:
                      name: '{{ include "common-gitops.names.release" . }}'
                  - secretRef:
                      name: '{{ include "common-gitops.names.release" . }}'
                  - configMapRef:
                      name: 'testfm-backend'

                ## Default Volume mounts
                ## @skip common-res.StatefulSet.items._.podSpec.spec.containers.genai-rag.volumeMounts
                ##
                volumeMounts:
                  # Q: Should these be readonly
                  - name: application-creds
                    mountPath: /data/application-creds
                    mountPropagation: None
                    # readOnly: false
                  - name: client-cert-secret-volume
                    mountPath: /data/client
                    mountPropagation: None
                  - name: keystore-secret-volume
                    mountPath: /data/kafka/keystore
                    mountPropagation: None
                  - name: redis-secret
                    mountPath: /data/redis
                    mountPropagation: None
                  - name: server-cert-secret-volume
                    mountPath: /data/server
                    mountPropagation: None
                  - name: spark-secret
                    mountPath: /data/spark
                    mountPropagation: None
                  - name: truststore-secret-volume
                    mountPath: /data/kafka/truststore
                    mountPropagation: None
                  - name: tunnel-creds
                    mountPath: /data/tunnel-creds
                    mountPropagation: None    ## Pod Volumes configuration

            ## @skip common-res.StatefulSet.items._.podSpec.spec.volumes
            volumes:
              - name: application-creds
                secret:
                  secretName: "application-creds"
                  defaultMode: 420
                  optional: false
              - name: client-cert-secret-volume
                secret:
                  secretName: "client-tls"
                  defaultMode: 420
                  optional: false
              - name: keystore-secret-volume
                secret:
                  secretName: "testfmkafka"
                  defaultMode: 420
                  optional: false
              - name: redis-secret
                secret:
                  secretName: "redis-server-tls"
                  defaultMode: 420
                  optional: false
              - name: server-cert-secret-volume
                secret:
                  secretName: "server-tls"
                  defaultMode: 420
                  optional: false
              - name: spark-secret
                secret:
                  secretName: "spark-server-tls"
                  defaultMode: 420
                  optional: false
              - name: truststore-secret-volume
                secret:
                  secretName: "kafka-cluster-cluster-ca-cert"
                  defaultMode: 420
                  optional: false
              - name: tunnel-creds
                secret:
                  secretName: "tunnel-creds"
                  defaultMode: 420
                  optional: false

  ## Configure configMaps for the chart here.
  ##
  ConfigMap:
    ## @param common-res.ConfigMap.enabled Enable or Disable the configmap from being created. Allowed values: `true` or `false`
    ##
    enabled: true
    ## Chart config variables
    ##
    items:
      _:
        data:
          ## @param common-res.ConfigMap.items._.data.TRANSFORMERS_CACHE for Transformers cache
          ##
          TRANSFORMERS_CACHE: "/genai-rag/.cache/huggingface/hub"
          ## @param common-res.ConfigMap.items._.data.HF_HOME for Huggingface home
          ##
          HF_HOME: "/genai-rag/.cache/huggingface/hub"
          ## @param common-res.ConfigMap.items._.data.ADMIN_API_URL for Admin api
          ##
          ADMIN_API_URL: "https://dataops.testfm.io/admin-api/"
          

  ## Configure secrets for the chart here.
  ##
  Secret:
    ## @param common-res.Secret.enabled Enable or Disable the secret from being created.
    ##
    enabled: true
    ## Chart secret variables
    ##
    items:
      _:
        stringData:
          ## @skip common-res.Secret.items._.stringData.OPENAI_API_KEY
          ##
          OPENAI_API_KEY: "<path:envs/prod#OPENAI_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.AG2_OPENAI_API_KEY
          ##
          AG2_OPENAI_API_KEY: "<path:envs/prod#AG2_OPENAI_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.PINECONE_API_KEY
          ##
          PINECONE_API_KEY: "<path:envs/prod#PINECONE_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.COHERE_API_KEY
          ##
          COHERE_API_KEY: "<path:envs/prod#COHERE_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.CLAUDE_API_KEY
          ##
          CLAUDE_API_KEY: "<path:envs/prod#CLAUDE_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.MISTRAL_API_KEY
          ##
          MISTRAL_API_KEY: "<path:envs/prod#MISTRAL_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.REPLICATE_API_KEY
          ##
          REPLICATE_API_KEY: "<path:envs/prod#REPLICATE_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.TOGETHER_API_KEY
          ##
          TOGETHER_API_KEY: "<path:envs/prod#TOGETHER_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.GEMINI_API_KEY
          ##
          GEMINI_API_KEY: "<path:envs/prod#GEMINI_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.DATABRICKS_API_KEY
          ##
          DATABRICKS_API_KEY: "<path:envs/prod#DATABRICKS_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.DATABRICKS_URL
          ##
          DATABRICKS_URL: "<path:envs/prod#DATABRICKS_URL>"
          ## @skip common-res.Secret.items._.stringData.VOYAGE_API_KEY
          ##
          VOYAGE_API_KEY: "<path:envs/prod#VOYAGE_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.NVIDIA_API_KEY
          ##
          NVIDIA_API_KEY: "<path:envs/prod#NVIDIA_API_KEY>"
          ## @skip common-res.Secret.items._.stringData.TRANSFORMERS_CACHE
          ##
          TRANSFORMERS_CACHE: "/genai-rag/.cache/huggingface/hub"
          ## @skip common-res.Secret.items._.stringData.HF_HOME
          ##
          HF_HOME: "/genai-rag/.cache/huggingface/hub"
          ## @skip common-res.Secret.items._.stringData.ADMIN_API_URL
          ##
          ADMIN_API_URL: "https://dataops.testfm.io/admin-api/"
          ## @skip common-res.Secret.items._.stringData.OTEL_SERVICE_NAME
          ##
          OTEL_SERVICE_NAME: "<path:envs/prod#OTEL_SERVICE_NAME>"
          ## @skip common-res.Secret.items._.stringData.OTEL_EXPORTER_OTLP_PROTOCOL
          ##
          OTEL_EXPORTER_OTLP_PROTOCOL: "<path:envs/prod#OTEL_EXPORTER_OTLP_PROTOCOL>"
          ## @skip common-res.Secret.items._.stringData.OTEL_EXPORTER_OTLP_ENDPOINT
          ##
          OTEL_EXPORTER_OTLP_ENDPOINT: "<path:envs/prod#OTEL_EXPORTER_OTLP_ENDPOINT>"
          ## @skip common-res.Secret.items._.stringData.OTEL_EXPORTER_OTLP_HEADERS
          ##
          OTEL_EXPORTER_OTLP_HEADERS: "<path:envs/prod#OTEL_EXPORTER_OTLP_HEADERS>"
          ## @skip common-res.Secret.items._.stringData.PERPLEXITY_API_KEY
          ##
          PERPLEXITY_API_KEY: "<path:envs/prod#PERPLEXITY_API_KEY>"


  ## Configure the services for the chart here.
  ## Additional services can be added by adding a dictionary key similar to the 'main' service.
  ## @default -- See below
  Service:
    ## Service configuration for main pod
    ##
    items:
      _:
        ## @param common-res.Service.items._.enabled Enables or disables the service
        ##
        enabled: true
        spec:
          ## @param common-res.Service.items._.spec.selector Additional selectors
          ##
          selector: {}

          ## @param common-res.Service.items._.spec.type Set the service type
          # Options: Simple(Loadbalancer), LoadBalancer, ClusterIP, NodePort
          ##
          type: ClusterIP

          ## @param common-res.Service.items._.spec.ipFamilyPolicy Specify the ip policy. Options: SingleStack, PreferDualStack, RequireDualStack
          ##
          # ipFamilyPolicy: SingleStack

          ## Configure the Service port information here.
          ## Additional ports can be added by adding a dictionary key similar to the 'http' service.
          ## @default -- See below
          ##
          ports:
            ## @param common-res.Service.items._.spec.ports[0].name The port number
            ##
            - name: http
              ## @param common-res.Service.items._.spec.ports[0].port The port number
              ##
              port: 8000

              ## @param common-res.Service.items._.spec.ports[0].protocol Port protocol. Allowed values: `TCP`, `SCTP` or `UDP`.
              ##
              protocol: TCP

              ## @param common-res.Service.items._.spec.ports[0].targetPort Specify a service targetPort if you wish to differ the service port from the application port.
              ## If `targetPort` is specified, this port number is used in the container definition instead of
              ## the `port` value. Therefore named ports are not supported for this field.
              ##
              targetPort: 8000
            ## @param common-res.Service.items._.spec.ports[0].name The port number
            ##
            - name: metrics
              ## @param common-res.Service.items._.spec.ports[0].port The port number
              ##
              port: 9000

              ## @param common-res.Service.items._.spec.ports[0].protocol Port protocol. Allowed values: `TCP`, `SCTP` or `UDP`.
              ##
              protocol: TCP

              ## @param common-res.Service.items._.spec.ports[0].targetPort Specify a service targetPort if you wish to differ the service port from the application port.
              ## If `targetPort` is specified, this port number is used in the container definition instead of
              ## the `port` value. Therefore named ports are not supported for this field.
              ##
              targetPort: 9000

  ## HPA configuration
  ##
  # HorizontalPodAutoscaler:
  #   ## @param common-res.HorizontalPodAutoscaler.enabled Toggle for enabling or disabling template.
  #   ##
  #   enabled: false
  #   ## Main deployment HPA settings
  #   ##
  #   items:
  #     _:
  #       spec:
  #         ## Scale Target
  #         ##
  #         scaleTargetRef:
  #           ## @param common-res.HorizontalPodAutoscaler.items._.spec.scaleTargetRef.apiVersion Target kind API Version
  #           ##
  #           apiVersion: apps/v1
  #           ## @param common-res.HorizontalPodAutoscaler.items._.spec.scaleTargetRef.kind Target kind
  #           ##
  #           kind: Deployment
  #           ## @param common-res.HorizontalPodAutoscaler.items._.spec.scaleTargetRef.name Target kind name
  #           ##
  #           name: '{{ include "common-gitops.names.release" . }}'
  #         ## @param common-res.HorizontalPodAutoscaler.items._.spec.minReplicas minimum amount of replica's to spawn
  #         ## default -- 1
  #         ##
  #         minReplicas: 1
  #         ## @param common-res.HorizontalPodAutoscaler.items._.spec.maxReplicas maximum amount of replica's to spawn
  #         ## default -- 10
  #         ##
  #         maxReplicas: 10
  #         ## Target metrics
  #         ##
  #         metrics:
  #           ## @skip common-res.HorizontalPodAutoscaler.items._.spec.metrics[0].type Metrics type
  #           ##
  #           - type: Object
  #             object:
  #               metric:
  #                 ## @param common-res.HorizontalPodAutoscaler.items._.spec.metrics[0].object.metric.name Metric name
  #                 ##
  #                 # - seriesQuery: 'custom_metric_current_sink_tasks{namespace!="",deployment=~".*"}'
  #                 #   resources:
  #                 #     overrides:
  #                 #       namespace:
  #                 #         resource: namespace
  #                 #       deployment:
  #                 #         resource: deployment
  #                 #   metricsQuery: 'max(custom_metric_current_sink_tasks) by (namespace, deployment)'
  #                 name: custom_metric_current_sink_tasks
  #               ## @skip common-res.HorizontalPodAutoscaler.items._.spec.metrics[0].object.describedObject Described object
  #               ##
  #               describedObject:
  #                 apiVersion: apps/v1
  #                 kind: Deployment
  #                 name: '{{ include "common-gitops.names.release" . }}'
  #               target:
  #                 ## @param common-res.HorizontalPodAutoscaler.items._.spec.metrics[0].object.target.type Metric target type
  #                 ##
  #                 type: Value
  #                 ## @param common-res.HorizontalPodAutoscaler.items._.spec.metrics[0].object.target.value Metric target value
  #                 ##
  #                 value: 1

  ## PodDisruptionBudget configuration
  ##
  PodDisruptionBudget:
    ## @param common-res.PodDisruptionBudget.enabled Toggle for enabling or disabling template.
    ##
    enabled: true
    ## Main deployment PDB settings
    ##
    items:
      _:
        spec:
          ## @param common-res.PodDisruptionBudget.items._.spec.minAvailable Minimum number of available pods
          ##
          minAvailable: 1

          selector:
            matchLables:
              app: '{{ include "common-gitops.names.release" . }}'
Ingress:
    ## @param common-res.Ingress.enabled Enable or disable the ingress
    ##
    enabled: true
    ## Configure the main ingress for main deployment service
    ##
    items:
      _:
        ## Provide additional annotations which may be required.
        ##
        annotations:
          # cert-manager.io/acme-challenge-type: dns01
          # cert-manager.io/acme-dns01-provider: route53
          # cert-manager.io/cluster-issuer: my-domain-cluster-issuer
          # kubernetes.io/tls-acme: "true"
          ## @param common-res.Ingress.items._.annotations.kubernetes.io/ingress.allow-http Enable or disable non ssl connection on the ingress
          # kubernetes.io/ingress.allow-http: "false"
          ## @param common-res.Ingress.items._.annotations.nginx.ingress.kubernetes.io/backend-protocol Backend protocol. Must match with backend service protocol
          # nginx.ingress.kubernetes.io/backend-protocol: HTTP
          ## @param common-res.Ingress.items._.annotations.nginx.ingress.kubernetes.io/preserve-trailing-slash Enable or disable preservation of trailing slash
          # nginx.ingress.kubernetes.io/preserve-trailing-slash: "false"
          ## @param common-res.Ingress.items._.annotations.nginx.ingress.kubernetes.io/server-snippet Additional nginx configurations using server-snippet annotation
          # nginx.ingress.kubernetes.io/server-snippet: |
          #   proxy_ssl_verify off;
          #   proxy_set_header X-Forwarded-Proto https;
          ## @param common-res.Ingress.items._.annotations.nginx.ingress.kubernetes.io/ssl-redirect Enable or disable redirecting users from non ssl to ssl URL
          # nginx.ingress.kubernetes.io/ssl-redirect: "true"
          nginx.ingress.kubernetes.io/client_max_body_size: 10M
          nginx.ingress.kubernetes.io/keep-alive-timeout: 300s
          nginx.ingress.kubernetes.io/proxy-connect-timeout: 300s
          nginx.ingress.kubernetes.io/proxy-read-timeout: 300s
          nginx.ingress.kubernetes.io/proxy-send-timeout: 300s
          nginx.ingress.kubernetes.io/rewrite-target: /$1

        ## @param common-res.Ingress.items._.labels Set labels on the deployment
        # -- Provide additional labels which may be required.
        ##
        labels: {}
        spec:
          ## @param common-res.Ingress.items._.spec.ingressClassName Set the ingressClass that is used for this ingress.
          ## Requires Kubernetes >=1.19
          ##
          ingressClassName: "nginx" # "nginx"

          ## Configure the hosts for the ingress
          ##
          rules:
            ## @param common-res.Ingress.items._.spec.rules[0].host Host address. Helm template can be passed.
            ##
            - host: "api-genai.testfm.io"
              ## Configure the paths for the host
              ##
              http:
                paths:
                  ## @param common-res.Ingress.items._.spec.rules[0].http.paths[0].path Path.  Helm template can be passed.
                  ##
                  - path: /(.*)
                    ## @param common-res.Ingress.items._.spec.rules[0].http.paths[0].pathType Ignored if not kubeVersion >= 1.14-0
                    ##
                    pathType: ImplementationSpecific
                    ## Service configuration for the host
                    ##
                    backend:
                      service:
                        ## @param common-res.Ingress.items._.spec.rules[0].http.paths[0].backend.service.name Overrides the service name reference for this path
                        ##
                        name: '{{ include "common-gitops.names.release" . }}'
                        ## @param common-res.Ingress.items._.spec.rules[0].http.paths[0].backend.service.port.number Overrides the service port reference for this path
                        ##
                        port:
                          number: 8000

prometheus-service-discovery:
  enabled: true
